#!/bin/bash
# Get details of a specific vulnerability
# Usage: dtrack-vulnerability.sh <source> <vuln-id>
# Example: dtrack-vulnerability.sh NVD CVE-2024-12345
set -eo pipefail
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
SOURCE="${1:-}"; VULN_ID="${2:-}"

if [[ -z "$SOURCE" || -z "$VULN_ID" ]]; then
    echo "Usage: $0 <source> <vuln-id>" >&2
    echo "Sources: NVD, NPM, GITHUB, VULNDB, OSSINDEX, OSV, SNYK, TRIVY" >&2
    exit 1
fi

"$SCRIPT_DIR/dtrack-api.sh" GET "/v1/vulnerability/source/${SOURCE}/vuln/${VULN_ID}" | jq '{
    uuid, vulnId, source, title, subtitle, description, severity,
    cvssV2BaseScore, cvssV3BaseScore, cvssV3Vector,
    epssScore, epssPercentile, cwes, references, recommendation,
    created, published, updated,
    affectedComponents: [.affectedComponents[]? | { uuid, name, version, purl }]
}'
